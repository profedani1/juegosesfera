<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lenguaje ‚Ä¢ Framework de Juegos</title>
<style>
 :root{
  /* Colores */
  --bg: #071018;
  --panel: rgba(0,0,0,0.45);
  --muted: rgba(255,255,255,0.08);
  --accent: #9fd;
  --danger: #f99;

  /* Radio y sombras */
  --radius: 1.6vh; /* escala con viewport */
  --card-gap: 1.2vh;

  /* Escala base de UI (se ajusta a la pantalla) */
  /* 1vh en m√≥viles peque√±os ser√° la referencia; clamp evita tama√±os extremos */
  --ui-scale: clamp(0.9, 1.7vh, 1.3);

  /* Tipograf√≠a: tama√±o adaptable y legible en m√≥vil */
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  font-size: clamp(14px, 2.2vw, 18px);
  color: #e8f8f5;
}

/* P√°gina y contenedor principal */
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  /* Evitar scroll inesperado en mobile; si necesitas scroll, c√°mbialo */
  overflow:hidden;
  -webkit-user-select:none;
  user-select:none;
  touch-action:manipulation; /* mejora respuesta t√°ctil en muchos navegadores */
}

/* Soporte para notch / safe-area en iOS */
#container{
  position:relative;
  width:100%;
  height:100%;
  padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, 0) env(safe-area-inset-bottom, 0) env(safe-area-inset-left, 0);
  box-sizing:border-box;
}

/* Top UI: flexible, colapsa en m√≥vil */
#uiTop{
  position:absolute;
  left:calc(3vw);
  top:calc(2vh);
  z-index:60;
  display:flex;
  gap:calc(var(--card-gap));
  align-items:center;
  flex-wrap:wrap;
  max-width:92vw;
  pointer-events:auto;
}

/* Botones t√°ctiles: √°reas grandes y consistentes */
.btn{
  background: rgba(255,255,255,0.06);
  border: 0.15vh solid rgba(255,255,255,0.08);
  padding: calc(0.8vh * var(--ui-scale)) calc(1.8vw * var(--ui-scale));
  border-radius: calc(var(--radius));
  cursor:pointer;
  color:#fff;
  font-size: clamp(13px, 1.8vh, 16px);
  line-height:1;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-height: clamp(44px, 6vh, 56px); /* hit target m√≠nimo ~44px */
  min-width: clamp(44px, 10vw, 110px);
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  transition: transform 120ms ease, background 120ms ease;
  box-shadow: 0 0.2vh 0.6vh rgba(0,0,0,0.35);
}

/* Evitar comportamiento hover en pantallas t√°ctiles */
@media (hover: none), (pointer: coarse) {
  .btn { transition: none; }
  .btn:hover { transform: none; background: rgba(255,255,255,0.08); }
}

/* Peque√±a animaci√≥n t√°ctil (active) que funciona bien en m√≥vil */
.btn:active{
  transform: translateY(1px) scale(0.995);
  background: rgba(255,255,255,0.12);
}

/* Texto peque√±o / indicadores */
.small { font-size: clamp(12px, 1.6vh, 14px); color:var(--accent); }

/* Pregunta / panel derecho (se posiciona en bottom en m√≥vil) */
#preguntaArea{
  position:absolute;
  right:calc(3vw);
  top:calc(2vh);
  z-index:70;
  background: var(--panel);
  padding: calc(2vh * var(--ui-scale));
  border-radius: calc(var(--radius));
  min-width: min(38vw, 360px);
  max-width: 86vw;
  box-sizing:border-box;
  box-shadow: 0 0.6vh 1.6vh rgba(0,0,0,0.6);
  pointer-events:auto;
}

/* Ajustes interiores */
#preguntaMain { font-weight:700; font-size: clamp(16px, 2.2vh, 20px); color:#fff; }
#preguntaEstado { margin-top:0.6vh; color:var(--accent); }

/* Advanced menu: drawer en m√≥vil, panel en desktop */
#advancedMenu{
  position:absolute;
  left:calc(3vw);
  top:calc(8vh);
  z-index:65;
  background:var(--panel);
  padding:calc(1.4vh * var(--ui-scale));
  border-radius: calc(var(--radius));
  width: min(280px, 86vw);
  max-height:60vh;
  overflow:auto;
  display:none; /* visible via JS */
  box-sizing:border-box;
  -webkit-overflow-scrolling: touch;
}

/* Mensaje final centrado */
#mensajeFinal{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  color:#fff;
  background:rgba(0,0,0,0.9);
  padding:calc(2.2vh * var(--ui-scale)) calc(3.2vw * var(--ui-scale));
  border-radius: calc(var(--radius) * 1.2);
  font-size: clamp(16px, 2.4vh, 22px);
  display:none;
  z-index:80;
  text-align:center;
  max-width:92vw;
}

/* Feedback banner estilo discreto pero legible */
#feedbackBanner{
  position:absolute;
  left:50%;
  bottom:calc(3vh);
  transform:translateX(-50%);
  z-index:75;
  background: rgba(255,255,255,0.08);
  padding: calc(0.8vh * var(--ui-scale)) calc(1.6vw * var(--ui-scale));
  border-radius: calc(var(--radius));
  font-weight:600;
  display:none;
}

/* Mistake log: √°rea t√°ctil y legible */
#mistakeLog{
  width:320px;
  display:none;
  height:100px;
  background:var(--bg);
  border:1px solid var(--muted);
  color:var(--accent);
  padding:8px;
  border-radius:10px;
  resize:none;
  font-size: clamp(12px, 1.6vh, 14px);
  box-sizing:border-box;
}

/* Responsive: mover pregunta al fondo en pantallas peque√±as y ajustar tama√±os */
@media (max-width:720px){
  #preguntaArea{
    right:calc(3vw);
    top:auto;
    bottom:calc(3vh);
    min-width: 64vw;
    padding: calc(1.6vh * var(--ui-scale));
  }

  #uiTop{
    left:calc(3vw);
    top:calc(1.4vh);
    gap:calc(1vh);
    align-items:flex-start;
  }

  #mistakeLog { width: 78vw; height: 18vh; }

  /* Mostrar advanced menu como full-width drawer cuando se abre (desktop sigue siendo panel) */
  #advancedMenu.open {
    display:block;
    position: fixed;
    left: 0;
    top: 0;
    height: 100%;
    width: min(92vw, 420px);
    max-width: 92vw;
    padding: calc(3vh);
    border-radius: 0;
    transform: translateX(0);
    box-shadow: 6px 0 18px rgba(0,0,0,0.6);
  }
}

/* Muy peque√±o (tel√©fonos peque√±os) */
@media (max-width:480px){
  :root { font-size: clamp(13px, 2.2vw, 16px); }
  .btn {
    min-width: 44px;
    padding: calc(0.6vh * var(--ui-scale)) calc(2.6vw * var(--ui-scale));
    border-radius: calc(var(--radius) * 0.95);
  }
  #preguntaArea { min-width: 72vw; padding: calc(1.4vh * var(--ui-scale)); }
}

/* Accesibilidad: enfoque visible para teclado */
:focus { outline: none; }
:focus-visible { outline: 3px solid rgba(159, 223, 255, 0.18); outline-offset: 3px; }

/* Reduce motion for users who prefer it (evita animaciones innecesarias en m√≥viles) */
@media (prefers-reduced-motion: reduce) {
  * { transition: none !important; animation: none !important; }
}

/* Prevent hover-only interactions on touch devices */
@media (pointer: coarse) {
  /* eliminar transformaciones por hover que confunden en touch */
  .btn:hover { transform: none; }
}

/* Make canvas or three renderer fill container if present (preparado) */
canvas, #three-canvas, .three-renderer {
  display:block;
  width:100%;
  height:100%;
  touch-action: none; /* si necesitas gestos de la app, pon touch-action apropiado en JS */
}

/* Helper utilities */
.hidden { display:none !important; }
.kv { display:flex; gap:0.8vh; align-items:center; }

/* Danger / accents helpers */
.badge { background:var(--muted); padding:6px 8px; border-radius:8px; font-weight:600; color:var(--accent); }
.badge.danger { color:var(--danger); }

</style>
</head>
<body>
<div id="container">
  <div id="uiTop">
    <div class="small" style="display:flex;align-items:center;gap:6px">
      <span style="margin-left:10px;color:#f99">Errores: <strong id="mistakeCount">0</strong></span>
      <span style="margin-left:10px" class="small">Modo:
        <select id="modeSelect" class="btn" style="padding:6px 10px">
          <option value="tunnel">T√∫nel</option>
          <option value="orbit">√ìrbita</option>
        </select>
      </span>
      <button id="btnRestart" class="btn">Reiniciar</button>
      <button id="btnPause" class="btn">Pausa</button>
      <button id="btnToggleLog" class="btn">Ver log</button>
      <button id="btnRecovMode" class="btn" style="display:none">Modo recuperaci√≥n</button>
      <button id="btnClearMistakes" class="btn" style="display:none">Limpiar errores</button>
    </div>
  </div>

  <div id="advancedMenu"></div>

  <div id="preguntaArea">
    <div id="preguntaMain" style="font-weight:700"></div>
    <div id="preguntaEstado" class="small"></div>
    <button id="btnToggleMenu" class="btn">Men√∫</button>
    <textarea id="mistakeLog" readonly></textarea>
  </div>

  <div id="mensajeFinal"></div>
  <div id="feedbackBanner"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<!-- Orden importante: storage primero -->
<script src="./core/storage.js"></script>
<script src="./core/questions.js"></script>
<script src="./core/ui.js"></script>
<script src="./core/core.js"></script>


<script>
(function bootstrap() {
  const params = new URLSearchParams(location.search);
  const modeParam = params.get('mode');
  const select = document.getElementById('modeSelect');
  if (modeParam) select.value = modeParam;

  const btnRecov = document.getElementById('btnRecovMode');
  const btnClear = document.getElementById('btnClearMistakes');

  function loadModeAndStart(){
    const modeName = select.value;
    const s = document.createElement('script');
    s.src = `modes/${modeName}.js`;
    s.onload = () => {
      if (typeof UI !== 'undefined')
        UI.buildAdvancedMenu(document.getElementById('advancedMenu'));
      window.GameCore.start(modeName);
    };
    s.onerror = () => alert(`No se pudo cargar el modo: ${modeName}`);
    document.body.appendChild(s);
  }

  // mostrar botones si hay errores guardados
  if (StorageAPI.hasMistakes()) {
    UI.showRecoveryButtons(true);
  }

  // üî• funci√≥n helper para botones t√°ctiles
  function bindTap(id, handler){
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener("pointerup", e => {
      e.preventDefault(); // evita zoom o doble tap en m√≥vil
      handler(e);
    });
  }

  // botones
  bindTap("btnRestart", () => window.GameCore.restart());
  bindTap("btnPause", () => window.GameCore.togglePause());

  bindTap("btnToggleMenu", () => {
    const menu = document.getElementById('advancedMenu');
    menu.style.display = (menu.style.display === 'none' || !menu.style.display) 
      ? 'block' 
      : 'none';
  });

  bindTap("btnToggleLog", () => {
    const ta = document.getElementById('mistakeLog');
    ta.style.display = (ta.style.display === 'none' || !ta.style.display) ? 'block' : 'none';
  });

  bindTap("btnClearMistakes", () => {
    if(confirm('¬øBorrar todos los errores guardados?')){
      StorageAPI.clearMistakes();
      UI.showRecoveryButtons(false);
    }
  });

  bindTap("btnRecovMode", () => {
    window.GameCore.startRecovery();
  });

  select.addEventListener("change", () => {
    window.GameCore.stop();
    loadModeAndStart();
    history.replaceState(null, '', `?mode=${select.value}`);
  });

  // Construir men√∫ avanzado (usa el estado ya cargado en QuestionsAPI)
  if(typeof UI !== 'undefined') UI.buildAdvancedMenu(document.getElementById('advancedMenu'));

  loadModeAndStart();
})();
</script>


</body>
</html>
